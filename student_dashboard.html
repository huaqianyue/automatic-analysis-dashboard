<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œä¸šåˆ†ææŠ¥å‘Š</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .fullscreen {
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-gray-50 fullscreen">
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-gray-900">ğŸ“Š ä½œä¸šåˆ†ææŠ¥å‘Š</h1>
                    <span id="studentIdDisplay" class="text-lg text-blue-600 font-medium"></span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- ä½œä¸šåˆ‡æ¢ä¸‹æ‹‰èœå• -->
                    <div class="relative">
                        <select id="assignmentSelector" class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <!-- ä½œä¸šé€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                    
                    <!-- é¢˜ç›®åˆ‡æ¢ä¸‹æ‹‰èœå• -->
                    <div class="relative" id="problemSelectorContainer">
                        <select id="problemSelector" class="hidden bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <!-- é¢˜ç›®é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                    <a href="index.html" class="text-blue-600 hover:text-blue-800 font-medium">è¿”å›é¦–é¡µ</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 fullscreen">
        
        <!-- åŠ è½½æç¤º -->
        <div id="loadingScreen" class="text-center py-20">
            <div class="loading mx-auto mb-4"></div>
            <p class="text-gray-600">æ­£åœ¨åŠ è½½ä½œä¸šæ•°æ®...</p>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div id="errorScreen" class="hidden text-center py-20">
            <div class="text-red-500 text-6xl mb-4">âš ï¸</div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">å­¦å·ä¸å­˜åœ¨</h2>
            <p class="text-gray-600 mb-4">è¯·è”ç³»ç®¡ç†å‘˜è·å–æ­£ç¡®çš„å­¦å·</p>
            <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition">è¿”å›é¦–é¡µ</a>
        </div>

        <!-- å­¦ç”Ÿè¯¦æƒ…å†…å®¹ -->
        <div id="studentContent" class="hidden">
            


            <!-- é¢˜ç›®è¯¦ç»†åˆ†æ -->
            <section class="mb-8" id="problemsAnalysis">
                <!-- é¢˜ç›®åˆ†æå†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
            </section>

        </div>

    </main>

    <script>
        // é¢˜ç›®ä¿¡æ¯ - ç›´æ¥å†™å…¥æºä»£ç ï¼Œé¿å…åŠ¨æ€åŠ è½½
        const problems = [
            {
                "id": "1SequentialList1",
                "shortDescription": "é¡ºåºè¡¨1ï¼šåˆ é™¤å¹¶è¿”å›æœ€å°å€¼",
                "fullDescription": "åˆ©ç”¨é¡ºåºè¡¨çš„æ“ä½œï¼Œå®ç°ä»¥ä¸‹çš„å‡½æ•°ï¼šä»é¡ºåºè¡¨ä¸­åˆ é™¤å…·æœ‰æœ€å°å€¼çš„å…ƒç´ å¹¶ç”±å‡½æ•°è¿”å›è¢«åˆ å…ƒç´ çš„å€¼ã€‚ç©ºå‡ºçš„ä½ç½®ç”±æœ€åä¸€ä¸ªå…ƒç´ å¡«è¡¥ï¼Œè‹¥é¡ºåºè¡¨ä¸ºç©ºåˆ™æ˜¾ç¤ºå‡ºé”™ä¿¡æ¯å¹¶é€€å‡ºè¿è¡Œã€‚"
            },
            {
                "id": "1SequentialList2",
                "shortDescription": "é¡ºåºè¡¨2ï¼šæ’å…¥å…ƒç´ xåˆ°ç¬¬iä¸ªä½ç½®",
                "fullDescription": "å‘é¡ºåºè¡¨ä¸­ç¬¬iä¸ªä½ç½®æ’å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ xã€‚å¦‚æœiä¸åˆç†åˆ™æ˜¾ç¤ºå‡ºé”™ä¿¡æ¯å¹¶é€€å‡ºè¿è¡Œã€‚"
            },
            {
                "id": "1SequentialList3",
                "shortDescription": "é¡ºåºè¡¨3ï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºé¡ºåºè¡¨",
                "fullDescription": "å°†ä¸¤ä¸ªæœ‰åºé¡ºåºè¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºé¡ºåºè¡¨å¹¶ç”±å‡½æ•°è¿”å›ç»“æœé¡ºåºè¡¨ã€‚"
            },
            {
                "id": "2String1",
                "shortDescription": "å­—ç¬¦ä¸²1ï¼šæŒ‰åˆ†éš”ç¬¦æ‹†åˆ†å­—ç¬¦ä¸²",
                "fullDescription": "ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ `words` å’Œä¸€ä¸ªå­—ç¬¦ `separator` ï¼Œè¯·ä½ æŒ‰ `separator` æ‹†åˆ† `words` ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²ã€‚è¿”å›ä¸€ä¸ªç”±æ‹†åˆ†åçš„æ–°å­—ç¬¦ä¸²ç»„æˆçš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œ"
            },
            {
                "id": "2String2",
                "shortDescription": "å­—ç¬¦ä¸²2ï¼šæœ€å¤§é‡å¤å­å­—ç¬¦ä¸²",
                "fullDescription": "ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² `sequence` å’Œ `word`ï¼Œå¦‚æœå­—ç¬¦ä¸² `word` è¿ç»­é‡å¤ `k` æ¬¡å½¢æˆçš„å­—ç¬¦ä¸²æ˜¯ `sequence` çš„ä¸€ä¸ªå­å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå•è¯ `word` çš„ **é‡å¤å€¼ä¸º k**ã€‚å•è¯ `word` çš„ **æœ€å¤§é‡å¤å€¼** æ˜¯å•è¯ `word` åœ¨ `sequence` ä¸­æœ€å¤§çš„é‡å¤å€¼ã€‚å¦‚æœ `word` ä¸æ˜¯ `sequence` çš„å­ä¸²ï¼Œé‚£ä¹ˆé‡å¤å€¼ `k` ä¸º `0`ã€‚\n\nè¯·ä½ è¿”å› **æœ€å¤§é‡å¤å€¼ k**ã€‚"
            },
            {
                "id": "2String3",
                "shortDescription": "å­—ç¬¦ä¸²3ï¼šæœ€é•¿å›æ–‡å­ä¸²",
                "fullDescription": "ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² `s`ï¼Œæ‰¾åˆ° `s` ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚\n\n**å›æ–‡ä¸²** æ˜¯æ­£ç€è¯»å’Œåç€è¯»éƒ½ä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚"
            },
            {
                "id": "2String4",
                "shortDescription": "å­—ç¬¦ä¸²4ï¼šæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²",
                "fullDescription": "ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² `s` ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ **æœ€é•¿å­ä¸²** çš„é•¿åº¦ã€‚\n\n**å­ä¸²** æ˜¯å­—ç¬¦ä¸²ä¸­è¿ç»­çš„å­—ç¬¦åºåˆ—ã€‚"
            }
        ];

        // å…¨å±€æ•°æ®
        let currentStudentId = null;
        let currentStudentName = null;
        let currentStudent = null;
        let currentProblemId = null;
        let currentAssignment = 'ç¬¬ä¸€æ¬¡ä½œä¸š'; // é»˜è®¤ä½œä¸š
        
        // å¯ç”¨ä½œä¸šåˆ—è¡¨
        const assignments = [
            'ç¬¬ä¸€æ¬¡ä½œä¸š',
            'ç¬¬äºŒæ¬¡ä½œä¸š'
        ];

        // ä»URLå‚æ•°è·å–å­¦å·å’Œå§“å
        function getURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                studentId: urlParams.get('studentId'),
                studentName: urlParams.get('studentName')
            };
        }

        // åŠ è½½å­¦ç”Ÿæ•°æ®
        function loadStudentData() {
            const params = getURLParameters();
            currentStudentId = params.studentId;
            currentStudentName = params.studentName;
            
            if (!currentStudentId) {
                showError('æœªæä¾›å­¦å·å‚æ•°');
                return;
            }
            
            if (!currentStudentName) {
                showError('æœªæä¾›å§“åå‚æ•°');
                return;
            }

            // æ˜¾ç¤ºå­¦å·å’Œå§“å
            document.getElementById('studentIdDisplay').textContent = `å­¦å·: ${currentStudentId} | å§“å: ${currentStudentName}`;
            
            // æ ¹æ®å½“å‰ä½œä¸šè¿‡æ»¤å‡ºå¯¹åº”çš„é¢˜ç›®
            // ç¬¬ä¸€æ¬¡ä½œä¸šçš„é¢˜ç›®IDä»¥"1"å¼€å¤´ï¼Œç¬¬äºŒæ¬¡ä½œä¸šçš„é¢˜ç›®IDä»¥"2"å¼€å¤´
            const currentAssignmentPrefix = currentAssignment === 'ç¬¬ä¸€æ¬¡ä½œä¸š' ? '1' : '2';
            const filteredProblems = problems.filter(problem => 
                problem.id.startsWith(currentAssignmentPrefix)
            );
            
            // é»˜è®¤åŠ è½½å½“å‰ä½œä¸šçš„ç¬¬ä¸€ä¸ªé¢˜ç›®
            if (filteredProblems.length > 0) {
                loadProblemData(filteredProblems[0].id);
            } else {
                showError('å½“å‰ä½œä¸šæ²¡æœ‰å¯ç”¨çš„é¢˜ç›®');
            }
        }
        
        // åŠ è½½ç‰¹å®šé¢˜ç›®çš„å­¦ç”Ÿæ•°æ®
        function loadProblemData(problemId) {
            currentProblemId = problemId;
            
            // æ„é€ å­¦ç”Ÿæ–‡ä»¶å¤¹åç§°ï¼šå­¦å·_å§“å
            const studentFolder = `${currentStudentId}_${currentStudentName}`;
            
            // æ„é€ statistics.jsonæ–‡ä»¶è·¯å¾„
            const filePath = `${currentAssignment}/${studentFolder}/${problemId}/statistics.json`;
            
            console.log('å°è¯•åŠ è½½æ–‡ä»¶:', filePath);
            
            // å°è¯•åŠ è½½å­¦ç”Ÿçš„ç»Ÿè®¡æ•°æ®
            fetch(filePath)
                .then(response => {
                    console.log('æ–‡ä»¶åŠ è½½å“åº”:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        // å¦‚æœè·¯å¾„å¤±è´¥ï¼Œå°è¯•æ›¿æ¢ä¸­æ–‡ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦
                        const normalizedStudentFolder = studentFolder.normalize('NFC');
                        const normalizedFilePath = `${currentAssignment}/${normalizedStudentFolder}/${problemId}/statistics.json`;
                        
                        console.log('å°è¯•åŠ è½½å½’ä¸€åŒ–è·¯å¾„:', normalizedFilePath);
                        
                        if (normalizedFilePath !== filePath) {
                            return fetch(normalizedFilePath)
                                .then(normalizedResponse => {
                                    console.log('å½’ä¸€åŒ–è·¯å¾„å“åº”:', normalizedResponse.status, normalizedResponse.statusText);
                                    if (!normalizedResponse.ok) {
                                        throw new Error('å­¦ç”Ÿæ•°æ®æ–‡ä»¶åŠ è½½å¤±è´¥');
                                    }
                                    return normalizedResponse;
                                });
                        }
                        throw new Error('å­¦ç”Ÿæ•°æ®æ–‡ä»¶åŠ è½½å¤±è´¥');
                    }
                    return response;
                })
                .then(response => response.json())
                .then(data => {
                    console.log('æˆåŠŸåŠ è½½æ•°æ®:', data);
                    
                    // å°†åŠ è½½çš„æ•°æ®è½¬æ¢ä¸ºä¸åŸdashboardDataå…¼å®¹çš„æ ¼å¼
                    currentStudent = {
                        student_id: currentStudentId,
                        problems: [{
                            problem_id: problemId,
                            score: data.test_result?.final_score || 0,
                            passed: (data.test_result?.final_score || 0) >= 60, // å‡è®¾60åˆ†ä¸ºåŠæ ¼
                            run_count: data.execution?.run_count || 0,
                            test_count: data.execution?.test_count || 0,
                            edit_count: data.edit_behavior?.total_edits || 0,
                            has_ai_analysis: !!data.ai_analysis,
                            ai_analysis: data.ai_analysis
                        }]
                    };
                    
                    renderStudentDashboard();
                    renderProblemAnalysis();
                })
                .catch(error => {
                    console.error('æ•°æ®åŠ è½½å¤±è´¥è¯¦æƒ…:', error);
                    showError('æœªæ‰¾åˆ°è¯¥å­¦å·çš„ä½œä¸šæ•°æ®');
                });
        }



        // æ¸²æŸ“å­¦ç”Ÿä»ªè¡¨æ¿
        function renderStudentDashboard() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('studentContent').classList.remove('hidden');
            
            renderAssignmentSelector();
            renderProblemSelector();
        }

        // æ¸²æŸ“ä½œä¸šé€‰æ‹©å™¨
        function renderAssignmentSelector() {
            const selector = document.getElementById('assignmentSelector');
            
            // ç”Ÿæˆä½œä¸šé€‰é¡¹
            selector.innerHTML = assignments.map(assignment => 
                `<option value="${assignment}">${assignment}</option>`
            ).join('');
            
            // è®¾ç½®å½“å‰é€‰ä¸­çš„ä½œä¸š
            selector.value = currentAssignment;
            
            // æ·»åŠ åˆ‡æ¢äº‹ä»¶
            selector.addEventListener('change', function() {
                currentAssignment = this.value;
                
                // æ ¹æ®æ–°åˆ‡æ¢çš„ä½œä¸šè¿‡æ»¤å‡ºå¯¹åº”çš„é¢˜ç›®
                const currentAssignmentPrefix = currentAssignment === 'ç¬¬ä¸€æ¬¡ä½œä¸š' ? '1' : '2';
                const filteredProblems = problems.filter(problem => 
                    problem.id.startsWith(currentAssignmentPrefix)
                );
                
                // é‡æ–°åŠ è½½æ–°ä½œä¸šçš„ç¬¬ä¸€ä¸ªé¢˜ç›®
                if (filteredProblems.length > 0) {
                    loadProblemData(filteredProblems[0].id);
                } else {
                    showError('å½“å‰ä½œä¸šæ²¡æœ‰å¯ç”¨çš„é¢˜ç›®');
                }
            });
        }
        
        // æ¸²æŸ“é¢˜ç›®é€‰æ‹©å™¨
        function renderProblemSelector() {
            const selector = document.getElementById('problemSelector');
            const container = document.getElementById('problemSelectorContainer');
            
            // æ ¹æ®å½“å‰ä½œä¸šè¿‡æ»¤å‡ºå¯¹åº”çš„é¢˜ç›®
            // ç¬¬ä¸€æ¬¡ä½œä¸šçš„é¢˜ç›®IDä»¥"1"å¼€å¤´ï¼Œç¬¬äºŒæ¬¡ä½œä¸šçš„é¢˜ç›®IDä»¥"2"å¼€å¤´
            const currentAssignmentPrefix = currentAssignment === 'ç¬¬ä¸€æ¬¡ä½œä¸š' ? '1' : '2';
            const filteredProblems = problems.filter(problem => 
                problem.id.startsWith(currentAssignmentPrefix)
            );
            
            // ç”Ÿæˆé¢˜ç›®é€‰é¡¹ï¼Œæ˜¾ç¤ºshortDescription
            selector.innerHTML = filteredProblems.map(problem => 
                `<option value="${problem.id}" ${problem.id === currentProblemId ? 'selected' : ''}>${problem.shortDescription}</option>`
            ).join('');
            
            // æ˜¾ç¤ºé€‰æ‹©å™¨
            selector.classList.remove('hidden');
            
            // æ·»åŠ åˆ‡æ¢äº‹ä»¶
            selector.addEventListener('change', function() {
                loadProblemData(this.value);
            });
        }

        // æ¸²æŸ“å•ä¸ªé¢˜ç›®åˆ†æ
        function renderProblemAnalysis() {
            if (!currentStudent || !currentStudent.problems || currentStudent.problems.length === 0) return;
            
            // è·å–å½“å‰é¢˜ç›®çš„æ•°æ®
            const problemData = currentStudent.problems[0];
            // è·å–å½“å‰é¢˜ç›®çš„è¯¦ç»†ä¿¡æ¯
            const currentProblemInfo = problems.find(p => p.id === currentProblemId);
            
            const hasAI = problemData.has_ai_analysis && problemData.ai_analysis;
            const ai = hasAI ? problemData.ai_analysis : null;
            
            const problemHTML = `
                <div class="border rounded-lg p-6 bg-gray-50">
                    <h4 class="text-xl font-bold text-gray-900 mb-4">ğŸ“ ${currentProblemInfo.shortDescription}</h4>
                    <div class="mb-4 p-4 bg-white rounded-lg">
                        <h5 class="font-semibold text-gray-900 mb-2">é¢˜ç›®æè¿°</h5>
                        <p class="text-gray-700 whitespace-pre-line">${currentProblemInfo.fullDescription}</p>
                    </div>
                    
                    <!-- åŸºæœ¬ç»Ÿè®¡ -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="bg-white rounded p-3">
                            <p class="text-xs text-gray-600">åˆ†æ•°</p>
                            <p class="text-2xl font-bold ${problemData.passed ? 'text-green-600' : 'text-red-600'}">
                            ${problemData.score}
                        </p>
                        </div>
                        <div class="bg-white rounded p-3">
                            <p class="text-xs text-gray-600">è¿è¡Œæ¬¡æ•°</p>
                            <p class="text-2xl font-bold">${problemData.run_count}</p>
                        </div>
                        <div class="bg-white rounded p-3">
                            <p class="text-xs text-gray-600">æµ‹è¯•æ¬¡æ•°</p>
                            <p class="text-2xl font-bold">${problemData.test_count}</p>
                        </div>
                        <div class="bg-white rounded p-3">
                            <p class="text-xs text-gray-600">ç¼–è¾‘æ¬¡æ•°</p>
                            <p class="text-2xl font-bold">${problemData.edit_count}</p>
                        </div>
                    </div>

                    ${hasAI ? `
                        <!-- AIåˆ†æè¯¦ç»†å†…å®¹ -->
                        <div class="bg-white rounded-lg p-4 mt-4 space-y-4">
                            <h5 class="text-lg font-bold text-gray-900 border-b pb-2">ğŸ¤– AIæ·±åº¦åˆ†æ</h5>
                            <p class="text-sm text-gray-500 italic mb-4">æ‰€æœ‰åˆ†æåŸºäºæäº¤çš„æ–‡ä»¶ï¼Œç”±å¤§æ¨¡å‹ç”Ÿæˆï¼Œç»“æœä»…ä¾›å‚è€ƒã€‚</p>
                            
                            <!-- æ€»ä½“è¯„ä¼° -->
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h6 class="font-bold text-gray-900 mb-3">ğŸ“Š æ€»ä½“è¯„ä¼°</h6>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-3">
                                    <div>
                                        <p class="text-xs text-gray-600">æŒæ¡åº¦</p>
                                        <p class="text-xl font-bold text-blue-600">${ai.overall_assessment?.mastery_percentage || 'N/A'}%</p>
                                        <p class="text-xs text-gray-500">${ai.overall_assessment?.mastery_level || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-600">æ¨èç­‰çº§</p>
                                        <p class="text-2xl font-bold">${ai.overall_assessment?.grade_recommendation || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-600">åˆ†æç½®ä¿¡åº¦</p>
                                        <p class="text-sm font-semibold">${ai.overall_assessment?.confidence_level || 'N/A'}</p>
                                    </div>
                                </div>
                                ${ai.overall_assessment?.key_strengths && ai.overall_assessment.key_strengths.length > 0 ? `
                                    <div class="mb-2">
                                        <p class="text-xs font-semibold text-green-700 mb-1">âœ… ä¼˜åŠ¿:</p>
                                        <ul class="text-xs text-gray-700 space-y-1">
                                            ${ai.overall_assessment.key_strengths.map(s => `<li class="break-words whitespace-normal">â€¢ ${s}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                ${ai.overall_assessment?.key_weaknesses && ai.overall_assessment.key_weaknesses.length > 0 ? `
                                    <div class="mb-2">
                                        <p class="text-xs font-semibold text-red-700 mb-1">âš ï¸ åŠ£åŠ¿:</p>
                                        <ul class="text-xs text-gray-700 space-y-1">
                                            ${ai.overall_assessment.key_weaknesses.map(w => `<li class="break-words whitespace-normal">â€¢ ${w}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                ${ai.overall_assessment?.priority_improvements && ai.overall_assessment.priority_improvements.length > 0 ? `
                                    <div>
                                        <p class="text-xs font-semibold text-blue-700 mb-1">ğŸ’¡ æ”¹è¿›å»ºè®®:</p>
                                        <ul class="text-xs text-gray-700 space-y-1">
                                            ${ai.overall_assessment.priority_improvements.map(i => `<li class="break-words whitespace-normal">â€¢ ${i}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <!-- ä»£ç è´¨é‡ & è°ƒè¯•èƒ½åŠ› -->
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-green-50 rounded-lg p-3">
                                    <h6 class="font-bold text-gray-900 mb-2">ğŸ’» ä»£ç è´¨é‡</h6>
                                    <div class="space-y-1 text-xs">
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">æ­£ç¡®æ€§:</span>
                                                <span class="font-semibold">${ai.code_quality?.correctness?.score || 'N/A'}åˆ†</span>
                                            </div>
                                            <p class="text-gray-500 text-xs">${ai.code_quality?.correctness?.comment || ''}</p>
                                        </div>
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">æ—¶é—´å¤æ‚åº¦:</span>
                                                <span class="font-semibold ${ai.code_quality?.time_complexity?.is_optimal ? 'text-green-600' : 'text-yellow-600'}">
                                                    ${ai.code_quality?.time_complexity?.actual || 'N/A'}
                                                </span>
                                            </div>
                                            <p class="text-gray-500 text-xs">${ai.code_quality?.time_complexity?.comment || ''}</p>
                                        </div>
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">å¯è¯»æ€§:</span>
                                                <span class="font-semibold">${ai.code_quality?.readability?.score || 'N/A'}åˆ†</span>
                                            </div>
                                            <p class="text-gray-500 text-xs">${ai.code_quality?.readability?.comment || ''}</p>
                                        </div>
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">ä»£ç é£æ ¼:</span>
                                                <span class="font-semibold">${ai.code_quality?.code_style?.score || 'N/A'}åˆ†</span>
                                            </div>
                                            <p class="text-gray-500 text-xs">${ai.code_quality?.code_style?.comment || ''}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-purple-50 rounded-lg p-3">
                                    <h6 class="font-bold text-gray-900 mb-2">ğŸ”§ è°ƒè¯•èƒ½åŠ›</h6>
                                    <div class="space-y-1 text-xs">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">å¾—åˆ†:</span>
                                            <span class="font-semibold text-purple-600">${ai.debugging_ability?.score || 'N/A'}åˆ†</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">ç­‰çº§:</span>
                                            <span class="font-semibold">${ai.debugging_ability?.level || 'N/A'}</span>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-gray-600 mb-1">ç­–ç•¥:</p>
                                            <p class="text-gray-700">${ai.debugging_ability?.debugging_strategy || 'N/A'}</p>
                                        </div>
                                        <div>
                                            <p class="text-gray-600 mb-1">æ•ˆç‡:</p>
                                            <p class="text-gray-700">${ai.debugging_ability?.error_fixing_efficiency || 'N/A'}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å­¦ä¹ è¿‡ç¨‹ -->
                            <div class="bg-yellow-50 rounded-lg p-3">
                                <h6 class="font-bold text-gray-900 mb-2">ğŸ“š å­¦ä¹ è¿‡ç¨‹</h6>
                                <div class="grid md:grid-cols-3 gap-3 text-xs">
                                    <div>
                                        <p class="text-gray-600 mb-1">è§£é¢˜ç­–ç•¥:</p>
                                        <p class="font-semibold">${ai.learning_process_assessment?.problem_solving_strategy || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 mb-1">ç‹¬ç«‹æ€§:</p>
                                        <p class="font-semibold">${ai.learning_process_assessment?.independence_level || 'N/A'}</p>
                                    </div>

                                </div>
                                ${ai.code_evolution_analysis?.total_iterations > 0 ? `
                                    <div class="mt-2 pt-2 border-t border-yellow-200">
                                        <p class="text-gray-600 text-xs">è¿­ä»£æ¬¡æ•°: <span class="font-semibold">${ai.code_evolution_analysis.total_iterations}</span></p>
                                        <p class="text-gray-600 text-xs">æ”¹è¿›æ¨¡å¼: <span class="font-semibold">${ai.code_evolution_analysis.improvement_pattern || 'N/A'}</span></p>
                                        <p class="text-gray-700 text-xs mt-1">${ai.code_evolution_analysis.learning_curve || ''}</p>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <!-- çŸ¥è¯†ç‚¹è¯¦ç»†åˆ†æ -->
                            ${ai.knowledge_points_analysis && ai.knowledge_points_analysis.length > 0 ? `
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <h6 class="font-bold text-gray-900 mb-2">ğŸ“– çŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ</h6>
                                    <div class="space-y-2 max-h-96 overflow-y-auto">
                                        ${ai.knowledge_points_analysis.map(kp => `
                                            <div class="bg-white rounded p-3 border-l-4 ${kp.is_weak ? 'border-red-500' : 'border-green-500'}">
                                                <div class="flex justify-between items-start mb-2">
                                                    <p class="text-xs font-semibold text-gray-900 break-words max-w-none">${kp.knowledge_point}</p>
                                                    <span class="text-xs px-2 py-1 rounded ${
                                                        kp.mastery_score >= 80 ? 'bg-green-100 text-green-800' :
                                                        kp.mastery_score >= 60 ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-red-100 text-red-800'
                                                    }">${kp.mastery_score}åˆ†</span>
                                                </div>
                                                <p class="text-xs text-gray-600 break-words max-w-none">${kp.mastery_level}</p>
                                                ${kp.specific_errors && kp.specific_errors.length > 0 ? `
                                                    <div class="mt-1">
                                                        <p class="text-xs font-semibold text-red-600">âŒ å…·ä½“é”™è¯¯:</p>
                                                        <ul class="text-xs text-gray-700 ml-3 list-disc">
                                                            ${kp.specific_errors.map(error => `<li class="break-words whitespace-normal overflow-visible max-w-none">${error.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`).join('')}
                                                        </ul>
                                                    </div>
                                                ` : ''}
                                                ${kp.evidence_from_history && kp.evidence_from_history.length > 0 ? `
                                                    <div class="mt-1">
                                                        <p class="text-xs font-semibold text-green-600">âœ… å†å²è¯æ®:</p>
                                                        <ul class="text-xs text-gray-700 ml-3 list-disc">
                                                            ${kp.evidence_from_history.map(evidence => `<li class="break-words whitespace-normal overflow-visible max-w-none">${evidence.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`).join('')}
                                                        </ul>
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div class="bg-yellow-50 rounded-lg p-4 text-center">
                            <p class="text-yellow-800">âš ï¸ è¯¥é¢˜ç›®æš‚æ— AIåˆ†ææ•°æ®</p>
                        </div>
                    `}
                </div>
            `;
            
            document.getElementById('problemsAnalysis').innerHTML = `
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ“ é¢˜ç›®è¯¦ç»†åˆ†æ</h2>
                    ${problemHTML}
                </div>
            `;
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('errorScreen').classList.remove('hidden');
            document.getElementById('errorScreen').querySelector('h2').textContent = message;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadStudentData();
        });
    </script>
</body>
</html>