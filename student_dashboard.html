<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作业分析报告</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .fullscreen {
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-gray-50 fullscreen">
    
    <!-- 顶部导航 -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-gray-900">📊 作业分析报告</h1>
                    <span id="studentIdDisplay" class="text-lg text-blue-600 font-medium"></span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- 作业切换下拉菜单 -->
                    <div class="relative">
                        <select id="assignmentSelector" class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <!-- 作业选项将动态生成 -->
                        </select>
                    </div>
                    
                    <!-- 题目切换下拉菜单 -->
                    <div class="relative" id="problemSelectorContainer">
                        <select id="problemSelector" class="hidden bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <!-- 题目选项将动态生成 -->
                        </select>
                    </div>
                    <a href="index.html" class="text-blue-600 hover:text-blue-800 font-medium">返回首页</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 fullscreen">
        
        <!-- 加载提示 -->
        <div id="loadingScreen" class="text-center py-20">
            <div class="loading mx-auto mb-4"></div>
            <p class="text-gray-600">正在加载作业数据...</p>
        </div>

        <!-- 错误提示 -->
        <div id="errorScreen" class="hidden text-center py-20">
            <div class="text-red-500 text-6xl mb-4">⚠️</div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">学号不存在</h2>
            <p class="text-gray-600 mb-4">请联系管理员获取正确的学号</p>
            <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition">返回首页</a>
        </div>

        <!-- 学生详情内容 -->
        <div id="studentContent" class="hidden">
            
            <!-- 题目详细分析 -->
            <section class="mb-8" id="problemsAnalysis">
                <!-- 题目分析内容将动态生成 -->
            </section>

        </div>

    </main>

    <script>
        // 题目信息 - 直接写入源代码，避免动态加载
        const problems = [
            // 第一次作业 - 顺序表
            {
                "id": "1SequentialList1",
                "shortDescription": "顺序表1：删除并返回最小值",
                "fullDescription": "利用顺序表的操作，实现以下的函数：从顺序表中删除具有最小值的元素并由函数返回被删元素的值。空出的位置由最后一个元素填补，若顺序表为空则显示出错信息并退出运行。"
            },
            {
                "id": "1SequentialList2",
                "shortDescription": "顺序表2：插入元素x到第i个位置",
                "fullDescription": "向顺序表中第i个位置插入一个新的元素x。如果i不合理则显示出错信息并退出运行。"
            },
            {
                "id": "1SequentialList3",
                "shortDescription": "顺序表3：合并两个有序顺序表",
                "fullDescription": "将两个有序顺序表合并成一个新的有序顺序表并由函数返回结果顺序表。"
            },
            // 第二次作业 - 字符串
            {
                "id": "2String1",
                "shortDescription": "字符串1：按分隔符拆分字符串",
                "fullDescription": "给你一个字符串数组 `words` 和一个字符 `separator` ，请你按 `separator` 拆分 `words` 中的每个字符串。返回一个由拆分后的新字符串组成的字符串数组，"
            },
            {
                "id": "2String2",
                "shortDescription": "字符串2：最大重复子字符串",
                "fullDescription": "给你一个字符串 `sequence` 和 `word`，如果字符串 `word` 连续重复 `k` 次形成的字符串是 `sequence` 的一个子字符串，那么单词 `word` 的 **重复值为 k**。单词 `word` 的 **最大重复值** 是单词 `word` 在 `sequence` 中最大的重复值。如果 `word` 不是 `sequence` 的子串，那么重复值 `k` 为 `0`。\n\n请你返回 **最大重复值 k**。"
            },
            {
                "id": "2String3",
                "shortDescription": "字符串3：最长回文子串",
                "fullDescription": "给你一个字符串 `s`，找到 `s` 中最长的回文子串。\n\n**回文串** 是正着读和反着读都一样的字符串。"
            },
            {
                "id": "2String4",
                "shortDescription": "字符串4：无重复字符的最长子串",
                "fullDescription": "给定一个字符串 `s` ，请你找出其中不含有重复字符的 **最长子串** 的长度。\n\n**子串** 是字符串中连续的字符序列。"
            },
            // 第三次作业 - 树
            {
                "id": "3Tree1",
                "shortDescription": "树1：计算二叉树的高度",
                "fullDescription": "给定一个二叉树的根节点 `root`，返回该二叉树的高度。二叉树的高度定义为从根节点到最远叶子节点的 最长路径上的节点数。空树的高度为0，单节点树的高度为1。",
            },
            {
                "id": "3Tree2",
                "shortDescription": "树2：翻转二叉树",
                "fullDescription": "给你一棵二叉树的根节点 `root` ，翻转这棵二叉树，并返回其根节点。",
            },
            {
                "id": "3Tree3",
                "shortDescription": "树3：判断对称二叉树",
                "fullDescription": "给你一个二叉树的根节点 `root` ，检查它是否轴对称。也就是说，它左右两棵子树是否是镜像对称的。",
            },
            {
                "id": "3Tree4",
                "shortDescription": "树4：表达式树中缀遍历（带括号）",
                "fullDescription": "给定一个二叉表达式树的根节点 `root`，该树表示一个算术表达式。树的叶子节点是操作数（例如：`a`, `b`, `1`, `2`），非叶子节点是运算符（例如：`+`, `-`, `*`, `/`）。\n\n请你实现一个函数，对这棵表达式树进行中序遍历，并返回其对应的中缀表达式字符串。在生成中缀表达式时，需要根据运算符的优先级和结合性，在必要时添加括号，以确保表达式的语义正确。\n\n**运算符优先级：**\n*   `*`, `/` 优先级高于 `+`, `-`。\n*   相同优先级的运算符（例如 `+` 和 `-`，或 `*` 和 `/`）遵循左结合性。",
            },
            // 第四次作业 - 图
            {
                "id": "4Graph1",
                "shortDescription": "图1：计算图的连通分量数量",
                "fullDescription": "给定一个包含 `n` 个节点和 `m` 条边的无向图。图的节点从 `0` 到 `n-1` 编号。你需要计算并返回图中连通分量的数量。\n\n一个图的连通分量是一个子图，其中任意两个顶点之间都存在路径，并且该子图不能再被更大的连通子图所包含。",
            },
            {
                "id": "4Graph2",
                "shortDescription": "图2：判断无向图中是否存在环",
                "fullDescription": "给定一个包含 `n` 个节点和 `m` 条边的无向图。图的节点从 `0` 到 `n-1` 编号。你需要判断图中是否存在环。\n\n环是指一条从某个节点出发，经过一系列不同节点，最终回到起点的路径。",
            },
            {
                "id": "4Graph3",
                "shortDescription": "图3：无权图最短路径",
                "fullDescription": "给定一个包含 `n` 个节点和 `m` 条边的无向图。图的节点从 `0` 到 `n-1` 编号。你需要找到从 `start` 节点到 `end` 节点的最短路径的长度。如果 `start` 节点和 `end` 节点之间没有路径，返回 `-1`。\n\n路径长度定义为路径上边的数量。",
            },
            // 第五次作业 - 查找
            {
                "id": "5Search1",
                "shortDescription": "查找1：查找旋转排序数组中的最小值",
                "fullDescription": "一个升序排序的数组在某个未知点（例如，`[0,1,2,4,5,6,7]` 可能变为 `[4,5,6,7,0,1,2]`）进行了旋转。给定这样一个旋转后的数组 `nums`，找到并返回其最小元素。\n\n数组中可能包含重复元素。",
            },
            {
                "id": "5Search2",
                "shortDescription": "查找2：寻找峰值",
                "fullDescription": "峰值元素是指其值大于其相邻元素（如果存在）的元素。给定一个整数数组 `nums`，你需要找到并返回数组中的任意一个峰值。\n\n你可以假设 `nums[-1] = nums[n] = -∞`（即数组两端的虚拟元素值极小）。数组中可能包含多个峰值，返回其中任意一个峰值的索引即可。\n\n**约束条件：**\n*   `1 <= nums.length <= 1000`\n*   `-2^31 <= nums[i] <= 2^31 - 1`\n*   对于所有有效的 `i`，`nums[i] != nums[i+1]`。",
            },
            {
                "id": "5Search3",
                "shortDescription": "查找3：两个有序数组的中位数",
                "fullDescription": "给定两个大小分别为 `m` 和 `n` 的有序数组 `nums1` 和 `nums2`。请你找出这两个有序数组的中位数，并返回。要求算法的时间复杂度为 `O(log(m+n))`。",
            },
            // 第六次作业 - 排序
            {
                "id": "6Sort1",
                "shortDescription": "排序1：合并区间",
                "fullDescription": "以数组 `intervals` 表示若干个区间。其中每个区间 `intervals[i] = [starti, endi]`。请你合并所有重叠的区间，并返回一个不重叠的区间数组，该数组中的每个区间恰好覆盖输入中的所有区间。\n\n**约束条件：**\n*   `1 <= intervals.length <= 10^4`\n*   `intervals[i].length == 2`\n*   `0 <= starti <= endi <= 10^4`",
            },
            {
                "id": "6Sort2",
                "shortDescription": "排序2：按照频率排序数组",
                "fullDescription": "给你一个整数数组 `nums`，请你将该数组按照数字出现的频率 **升序** 排序。如果频率相同，则按照数值 **降序** 排序。\n\n**约束条件：**\n*   `1 <= nums.length <= 100`\n*   `-100 <= nums[i] <= 100`",
            },
            {
                "id": "6Sort3",
                "shortDescription": "排序3：排序链表",
                "fullDescription": "给你链表的头节点 `head` ，请将其按 **升序** 排列并返回排序后的链表头。\n\n尝试使用 `O(n log n)` 时间复杂度和 **常数级** 空间复杂度来解决此问题。\n\n**约束条件：**\n*   链表中节点的数量在 `[0, 5 * 10^4]` 范围内\n*   `-10^5 <= Node.val <= 10^5`",
            }
        ];

        // 全局数据
        let currentStudentId = null;
        let currentStudentName = null;
        let currentStudent = null;
        let currentProblemId = null;
        // 默认作业改为 "第一次作业"，后续逻辑会根据选择器更新
        let currentAssignment = '第一次作业'; 
        
        // 可用作业列表
        const assignments = [
            '第一次作业',
            '第二次作业',
            '第三次作业',
            '第四次作业',
            '第五次作业',
            '第六次作业'
        ];

        // 从URL参数获取学号和姓名
        function getURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                studentId: urlParams.get('studentId'),
                studentName: urlParams.get('studentName')
            };
        }

        // 加载学生数据
        function loadStudentData() {
            const params = getURLParameters();
            currentStudentId = params.studentId;
            currentStudentName = params.studentName;
            
            if (!currentStudentId) {
                showError('未提供学号参数');
                return;
            }
            
            if (!currentStudentName) {
                showError('未提供姓名参数');
                return;
            }

            // 显示学号和姓名
            document.getElementById('studentIdDisplay').textContent = `学号: ${currentStudentId} | 姓名: ${currentStudentName}`;
            
            // 初始化作业和题目选择器
            renderAssignmentSelector();
            renderProblemSelector();

            // 默认加载当前作业的第一个题目 (在renderProblemSelector之后调用)
            const initialProblemId = getInitialProblemIdForAssignment(currentAssignment);
            if (initialProblemId) {
                loadProblemData(initialProblemId);
            } else {
                showError('当前作业没有可用的题目');
            }
        }

        // 根据作业名称获取该作业的第一个题目ID
        function getInitialProblemIdForAssignment(assignmentName) {
            const prefix = getAssignmentPrefix(assignmentName);
            const filteredProblems = problems.filter(problem => problem.id.startsWith(prefix));
            return filteredProblems.length > 0 ? filteredProblems[0].id : null;
        }

        // 获取作业名称对应的ID前缀
        function getAssignmentPrefix(assignmentName) {
            switch (assignmentName) {
                case '第一次作业': return '1';
                case '第二次作业': return '2';
                case '第三次作业': return '3';
                case '第四次作业': return '4';
                case '第五次作业': return '5';
                case '第六次作业': return '6';
                default: return '';
            }
        }
        
        // 加载特定题目的学生数据
        function loadProblemData(problemId) {
            currentProblemId = problemId;
            
            // 构造学生文件夹名称：学号_姓名
            const studentFolder = `${currentStudentId}_${currentStudentName}`;
            
            // 构造statistics.json文件路径
            const filePath = `${currentAssignment}/${studentFolder}/${problemId}/statistics.json`;
            
            console.log('尝试加载文件:', filePath);
            
            // 尝试加载学生的统计数据
            fetch(filePath)
                .then(response => {
                    console.log('文件加载响应:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        // 如果路径失败，尝试替换中文空格和特殊字符
                        const normalizedStudentFolder = studentFolder.normalize('NFC');
                        const normalizedFilePath = `${currentAssignment}/${normalizedStudentFolder}/${problemId}/statistics.json`;
                        
                        console.log('尝试加载归一化路径:', normalizedFilePath);
                        
                        if (normalizedFilePath !== filePath) {
                            return fetch(normalizedFilePath)
                                .then(normalizedResponse => {
                                    console.log('归一化路径响应:', normalizedResponse.status, normalizedResponse.statusText);
                                    if (!normalizedResponse.ok) {
                                        throw new Error('学生数据文件加载失败');
                                    }
                                    return normalizedResponse;
                                });
                        }
                        throw new Error('学生数据文件加载失败');
                    }
                    return response;
                })
                .then(response => response.json())
                .then(data => {
                    console.log('成功加载数据:', data);
                    
                    // 将加载的数据转换为与原dashboardData兼容的格式
                    currentStudent = {
                        student_id: currentStudentId,
                        problems: [{
                            problem_id: problemId,
                            score: data.test_result?.final_score || 0,
                            passed: (data.test_result?.final_score || 0) >= 60, // 假设60分为及格
                            run_count: data.execution?.run_count || 0,
                            test_count: data.execution?.test_count || 0,
                            edit_count: data.edit_behavior?.total_edits || 0,
                            has_ai_analysis: !!data.ai_analysis,
                            ai_analysis: data.ai_analysis
                        }]
                    };
                    
                    renderStudentDashboard();
                    renderProblemAnalysis();
                })
                .catch(error => {
                    console.error('数据加载失败详情:', error);
                    showError('未找到该学号的作业数据');
                });
        }

        // 渲染学生仪表板 (主要是显示内容和更新选择器)
        function renderStudentDashboard() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('studentContent').classList.remove('hidden');
            
            // 确保选择器已经渲染，并且当前值设置正确
            document.getElementById('assignmentSelector').value = currentAssignment;
            renderProblemSelector(); // 重新渲染题目选择器以匹配当前作业
        }

        // 渲染作业选择器
        function renderAssignmentSelector() {
            const selector = document.getElementById('assignmentSelector');
            
            // 生成作业选项
            selector.innerHTML = assignments.map(assignment => 
                `<option value="${assignment}">${assignment}</option>`
            ).join('');
            
            // 设置当前选中的作业
            selector.value = currentAssignment;
            
            // 添加切换事件
            selector.addEventListener('change', function() {
                currentAssignment = this.value;
                // 题目选择器需要根据新的作业进行更新
                renderProblemSelector();
                
                // 加载新作业的第一个题目
                const initialProblemId = getInitialProblemIdForAssignment(currentAssignment);
                if (initialProblemId) {
                    loadProblemData(initialProblemId);
                } else {
                    showError('当前作业没有可用的题目');
                }
            });
        }
        
        // 渲染题目选择器
        function renderProblemSelector() {
            const selector = document.getElementById('problemSelector');
            
            // 根据当前作业过滤出对应的题目
            const currentAssignmentPrefix = getAssignmentPrefix(currentAssignment);
            const filteredProblems = problems.filter(problem => 
                problem.id.startsWith(currentAssignmentPrefix)
            );
            
            // 生成题目选项，显示shortDescription
            selector.innerHTML = filteredProblems.map(problem => 
                `<option value="${problem.id}" ${problem.id === currentProblemId ? 'selected' : ''}>${problem.shortDescription}</option>`
            ).join('');
            
            // 显示选择器
            selector.classList.remove('hidden');
            
            // 添加切换事件
            selector.addEventListener('change', function() {
                loadProblemData(this.value);
            });
        }

        // 渲染单个题目分析
        function renderProblemAnalysis() {
            if (!currentStudent || !currentStudent.problems || currentStudent.problems.length === 0) return;
            
            // 获取当前题目的数据
            const problemData = currentStudent.problems[0];
            // 获取当前题目的详细信息
            const currentProblemInfo = problems.find(p => p.id === currentProblemId);
            
            const hasAI = problemData.has_ai_analysis && problemData.ai_analysis;
            const ai = hasAI ? problemData.ai_analysis : null;
            
            const problemHTML = `
                <div class="border rounded-lg p-6 bg-gray-50">
                    <h4 class="text-xl font-bold text-gray-900 mb-4">📝 ${currentProblemInfo.shortDescription}</h4>
                    <div class="mb-4 p-4 bg-white rounded-lg">
                        <h5 class="font-semibold text-gray-900 mb-2">题目描述</h5>
                        <p class="text-gray-700 whitespace-pre-line">${currentProblemInfo.fullDescription}</p>
                    </div>
                    
                    <!-- 基本统计 -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="bg-white rounded p-3">
                            <p class="text-sm text-gray-600">分数</p>
                            <p class="text-2xl font-bold ${problemData.passed ? 'text-green-600' : 'text-red-600'}">
                            ${problemData.score}
                        </p>
                        </div>
                        <div class="bg-white rounded p-3">
                            <p class="text-sm text-gray-600">运行次数</p>
                            <p class="text-2xl font-bold">${problemData.run_count}</p>
                        </div>
                        <div class="bg-white rounded p-3">
                            <p class="text-sm text-gray-600">测试次数</p>
                            <p class="text-2xl font-bold">${problemData.test_count}</p>
                        </div>
                    </div>

                    ${hasAI ? `
                        <!-- AI分析详细内容 -->
                        <div class="bg-white rounded-lg p-4 mt-4 space-y-4">
                            <h5 class="text-lg font-bold text-gray-900 border-b pb-2">🤖 AI深度分析</h5>
                            <p class="text-sm text-gray-500 italic mb-4">所有分析基于提交的文件，由大模型生成，结果仅供参考。</p>
                            
                            <!-- 总体评估 -->
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h6 class="font-bold text-gray-900 mb-3">📊 总体评估</h6>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-3">
                                    <div>
                                        <p class="text-sm text-gray-600">掌握度</p>
                                        <p class="text-xl font-bold text-blue-600">${ai.overall_assessment?.mastery_percentage || 'N/A'}%</p>
                                        <p class="text-sm text-gray-500">${ai.overall_assessment?.mastery_level || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">推荐等级</p>
                                        <p class="text-2xl font-bold">${ai.overall_assessment?.grade_recommendation || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">分析置信度</p>
                                        <p class="text-sm font-semibold">${ai.overall_assessment?.confidence_level || 'N/A'}</p>
                                    </div>
                                </div>
                                ${ai.overall_assessment?.key_strengths && ai.overall_assessment.key_strengths.length > 0 ? `
                                    <div class="mb-2">
                                        <p class="text-sm font-semibold text-green-700 mb-1">✅ 优势:</p>
                                        <ul class="text-sm text-gray-700 space-y-1">
                                            ${ai.overall_assessment.key_strengths.map(s => `<li class="break-words whitespace-normal">• ${s}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                ${ai.overall_assessment?.key_weaknesses && ai.overall_assessment.key_weaknesses.length > 0 ? `
                                    <div class="mb-2">
                                        <p class="text-sm font-semibold text-red-700 mb-1">⚠️ 劣势:</p>
                                        <ul class="text-sm text-gray-700 space-y-1">
                                            ${ai.overall_assessment.key_weaknesses.map(w => `<li class="break-words whitespace-normal">• ${w}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                ${ai.overall_assessment?.priority_improvements && ai.overall_assessment.priority_improvements.length > 0 ? `
                                    <div>
                                        <p class="text-sm font-semibold text-blue-700 mb-1">💡 改进建议:</p>
                                        <ul class="text-sm text-gray-700 space-y-1">
                                            ${ai.overall_assessment.priority_improvements.map(i => `<li class="break-words whitespace-normal">• ${i}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <!-- 代码质量 & 调试能力 -->
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-green-50 rounded-lg p-3">
                                    <h6 class="font-bold text-gray-900 mb-2">💻 代码质量</h6>
                                    <div class="space-y-1 text-sm">
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">正确性:</span>
                                                <span class="font-semibold">${ai.code_quality?.correctness?.score || 'N/A'}分</span>
                                            </div>
                                            <p class="text-gray-500 text-sm">${ai.code_quality?.correctness?.comment || ''}</p>
                                        </div>
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">时间复杂度:</span>
                                                <span class="font-semibold ${ai.code_quality?.time_complexity?.is_optimal ? 'text-green-600' : 'text-yellow-600'}">
                                                    ${ai.code_quality?.time_complexity?.actual || 'N/A'}
                                                </span>
                                            </div>
                                            <p class="text-gray-500 text-sm">${ai.code_quality?.time_complexity?.comment || ''}</p>
                                        </div>
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">可读性:</span>
                                                <span class="font-semibold">${ai.code_quality?.readability?.score || 'N/A'}分</span>
                                            </div>
                                            <p class="text-gray-500 text-sm">${ai.code_quality?.readability?.comment || ''}</p>
                                        </div>
                                        <div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">代码风格:</span>
                                                <span class="font-semibold">${ai.code_quality?.code_style?.score || 'N/A'}分</span>
                                            </div>
                                            <p class="text-gray-500 text-sm">${ai.code_quality?.code_style?.comment || ''}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-purple-50 rounded-lg p-3">
                                    <h6 class="font-bold text-gray-900 mb-2">🔧 调试能力</h6>
                                    <div class="space-y-1 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">得分:</span>
                                            <span class="font-semibold text-purple-600">${ai.debugging_ability?.score || 'N/A'}分</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">等级:</span>
                                            <span class="font-semibold">${ai.debugging_ability?.level || 'N/A'}</span>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-gray-600 mb-1">策略:</p>
                                            <p class="text-gray-700">${ai.debugging_ability?.debugging_strategy || 'N/A'}</p>
                                        </div>
                                        <div>
                                            <p class="text-gray-600 mb-1">效率:</p>
                                            <p class="text-gray-700">${ai.debugging_ability?.error_fixing_efficiency || 'N/A'}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 学习过程 -->
                            <div class="bg-yellow-50 rounded-lg p-3">
                                <h6 class="font-bold text-gray-900 mb-2">📚 学习过程</h6>
                                <div class="grid md:grid-cols-3 gap-3 text-sm">
                                    <div>
                                        <p class="text-gray-600 mb-1">解题策略:</p>
                                        <p class="font-semibold">${ai.learning_process_assessment?.problem_solving_strategy || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 mb-1">独立性:</p>
                                        <p class="font-semibold">${ai.learning_process_assessment?.independence_level || 'N/A'}</p>
                                    </div>

                                </div>
                                ${ai.code_evolution_analysis?.total_iterations > 0 ? `
                                    <div class="mt-2 pt-2 border-t border-yellow-200">
                                        <p class="text-gray-600 text-sm">迭代次数: <span class="font-semibold">${ai.code_evolution_analysis.total_iterations}</span></p>
                                        <p class="text-gray-600 text-sm">改进模式: <span class="font-semibold">${ai.code_evolution_analysis.improvement_pattern || 'N/A'}</span></p>
                                        <p class="text-gray-700 text-sm mt-1">${ai.code_evolution_analysis.learning_curve || ''}</p>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <!-- 知识点详细分析 -->
                            ${ai.knowledge_points_analysis && ai.knowledge_points_analysis.length > 0 ? `
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <h6 class="font-bold text-gray-900 mb-2">📖 知识点掌握情况</h6>
                                    <div class="space-y-2 max-h-96 overflow-y-auto">
                                        ${ai.knowledge_points_analysis.map(kp => `
                                            <div class="bg-white rounded p-3 border-l-4 ${kp.is_weak ? 'border-red-500' : 'border-green-500'}">
                                                <div class="flex justify-between items-start mb-2">
                                                    <p class="text-sm font-semibold text-gray-900 break-words max-w-none">${kp.knowledge_point}</p>
                                                    <span class="text-sm px-2 py-1 rounded ${
                                                        kp.mastery_score >= 80 ? 'bg-green-100 text-green-800' :
                                                        kp.mastery_score >= 60 ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-red-100 text-red-800'
                                                    }">${kp.mastery_score}分</span>
                                                </div>
                                                <p class="text-sm text-gray-600 break-words max-w-none">${kp.mastery_level}</p>
                                                ${kp.specific_errors && kp.specific_errors.length > 0 ? `
                                                    <div class="mt-1">
                                                        <p class="text-sm font-semibold text-red-600">❌ 具体错误:</p>
                                                        <ul class="text-sm text-gray-700 ml-3 list-disc">
                                                            ${kp.specific_errors.map(error => `<li class="break-words whitespace-normal overflow-visible max-w-none">${error.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`).join('')}
                                                        </ul>
                                                    </div>
                                                ` : ''}
                                                ${kp.evidence_from_history && kp.evidence_from_history.length > 0 ? `
                                                    <div class="mt-1">
                                                        <p class="text-sm font-semibold text-green-600">✅ 历史证据:</p>
                                                        <ul class="text-sm text-gray-700 ml-3 list-disc">
                                                            ${kp.evidence_from_history.map(evidence => `<li class="break-words whitespace-normal overflow-visible max-w-none">${evidence.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`).join('')}
                                                        </ul>
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div class="bg-yellow-50 rounded-lg p-4 text-center">
                            <p class="text-yellow-800">⚠️ 该题目暂无AI分析数据</p>
                        </div>
                    `}
                </div>
            `;
            
            document.getElementById('problemsAnalysis').innerHTML = `
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">📝 题目详细分析</h2>
                    ${problemHTML}
                </div>
            `;
        }

        // 显示错误
        function showError(message) {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('errorScreen').classList.remove('hidden');
            document.getElementById('errorScreen').querySelector('h2').textContent = message;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadStudentData();
        });
    </script>
</body>
</html>